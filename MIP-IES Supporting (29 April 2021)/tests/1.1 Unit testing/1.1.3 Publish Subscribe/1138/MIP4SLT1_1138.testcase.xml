<?xml version="1.0"?>
<TestCase xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="https://mip-interop.org/schemas/SEPT/2016/09/29/TestAutomation.xsd">
  <TestCaseId>
    <TestCaseIdBlock>MIP4</TestCaseIdBlock>
    <TestCaseIdLevel>SLT1</TestCaseIdLevel>
    <TestCaseIdGroup>11</TestCaseIdGroup>
    <TestCaseIdNumber>38</TestCaseIdNumber>
  </TestCaseId>
  <TestCaseTitle>Subscribe, no initial termination time</TestCaseTitle>
  <TestCaseExecutionPriority>2</TestCaseExecutionPriority>
  <TestCaseObjective>The objective is for the Consumer to subscribe to a topic provided by the Provider.</TestCaseObjective>
  <TestCaseScenario>The Consumer is interested in receiving regular updates on  a topic in an asynchronous way (i.e. without polling the Producer).</TestCaseScenario>
  <TestCaseEnvironment>Internet or Co-located. Exchange Pattern: P/S.</TestCaseEnvironment>
  <TestCaseMaximumParticipation>2 </TestCaseMaximumParticipation>
  <TestCasePreCondition>MIP4SLT1_1211, MIP4SLT1_1213, MIP4SLT1_1215, MIP4SLT1_1130
Prior to initiating exchange of MIP4.0 messages, each participant in the exchange will complete the MIP4.0 Joining Questionnaire [REF-MIP-5] and share this questionnaire with their exchange partners. The exchange of completed questionnaires will:
* Inform exchange partners of the capabilities of a partner system
* Allow  partners to exchange source identifiers
* Aid in the early identification of potential issues

The exchange partners are expected to resolve any identified issues prior to the actual exchange of MIP4.0 messages.

Exigence-1 Prior to initiating MIP4.0 Information Exchange, the exchange partners shall complete and share the MIP4.0 Joining Questionnaire.[REF-MIP-5]

Both Consumer and Producer systems conform to MIP4.0 Publish/Subscribe Exchange Pattern Specification.
Both Consumer and Producer are able to process and exchange information represented according to MIP4.0 Information Schemas.Consumer successfully discovered the target Producer. The system on the Consumer side has been properly configured and is ready to interact with the Producer system. The Producer system broadcasts at least some of the topics requested.</TestCasePreCondition>
  <TestCaseInput>N/A.</TestCaseInput>
  <TestCaseConclusion>The test is concluded after the Consumer is receiving regular asynchronous updates of the requested topics from the Producer. The data received in these updates is valid and complete.</TestCaseConclusion>
  <TestCaseOutput>N/A.</TestCaseOutput>
  <TestCaseTraceability>REQ_EM_0008, REQ_EM_0010.</TestCaseTraceability>
  <TestCaseStep>
    <TestCaseStepNumber>1</TestCaseStepNumber>
    <TestCaseStepAction>The Consumer subscribes to the Producer in order to advertise its interest in a subset of the data space.
rpw:GetResourceProperty
with parameters wsn:FullTopicExpression, wsn:FixedTopicSet, wsn:TopicExpressionDialect and wstop:TopicSet.</TestCaseStepAction>
    <TestCaseStepResult>The Producer receives a valid request for resource properties. </TestCaseStepResult>
    <TestCaseStepDestination>2</TestCaseStepDestination>
    <TestCaseStepSource>1</TestCaseStepSource>
  </TestCaseStep>
  <TestCaseStep>
    <TestCaseStepNumber>2</TestCaseStepNumber>
    <TestCaseStepAction>Producer sends the topic(s) requested to the Consumer </TestCaseStepAction>
    <TestCaseStepResult>Consumer receives the requested topic(s). </TestCaseStepResult>
    <TestCaseStepDestination>1</TestCaseStepDestination>
    <TestCaseStepSource>2</TestCaseStepSource>
  </TestCaseStep>
  <TestCaseStep>
    <TestCaseStepNumber>3</TestCaseStepNumber>
    <TestCaseStepAction>The Consumer processes the list of exposed topics, prepares a filter set, and requests a subscription on one or more topics to the Producer using the wsn-b:Subscribe operation. Consumer does NOT specify a termination time for the subscription(s) </TestCaseStepAction>
    <TestCaseStepResult>Producer receives subscription request(s) for one or more topics. </TestCaseStepResult>
    <TestCaseStepDestination>2</TestCaseStepDestination>
    <TestCaseStepSource>1</TestCaseStepSource>
  </TestCaseStep>
  <TestCaseStep>
    <TestCaseStepNumber>4</TestCaseStepNumber>
    <TestCaseStepAction>Producer accepts or rejects the subscription requests.
Producer checks subscription filters and determines if data matches specified filters. If it does, the Producer sends a wsn-b:Notify to the address specified in the wsn-b:ConsumerReference for EACH matching subscription. </TestCaseStepAction>
    <TestCaseStepResult>The Producer accepts the requests.
The Producer sends notification to the Consumer.
The Consumer processes the data contained in the message(s). </TestCaseStepResult>
    <TestCaseStepDestination>1</TestCaseStepDestination>
    <TestCaseStepSource>2</TestCaseStepSource>
  </TestCaseStep>
  <TestCaseEventGeneration>true</TestCaseEventGeneration>
</TestCase>