<?xml version="1.0"?>
<TestCase xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="https://mip-interop.org/schemas/SEPT/2016/09/29/TestAutomation.xsd">
  <TestCaseId>
    <TestCaseIdBlock>MIP4</TestCaseIdBlock>
    <TestCaseIdLevel>SLT1</TestCaseIdLevel>
    <TestCaseIdGroup>11</TestCaseIdGroup>
    <TestCaseIdNumber>56</TestCaseIdNumber>
  </TestCaseId>
  <TestCaseTitle>Notify multiple consumers with overlapping subscriptions</TestCaseTitle>
  <TestCaseExecutionPriority>1</TestCaseExecutionPriority>
  <TestCaseObjective>The objective is for the Producer to notify the Consumers of updates to the Current Situation according to the filtering criteria provided on overlapping subscriptions.</TestCaseObjective>
  <TestCaseScenario>The Consumers receive notifications from the Producer matching the current subscriptions. Test to be derived on multiple kinds of subscriptions (topic, geographical filter, sources) and shapes.This test case requires more than 2 participants (multi-node test).</TestCaseScenario>
  <TestCaseEnvironment>Internet or Co-located. Exchange Pattern: P/S.</TestCaseEnvironment>
  <TestCaseMaximumParticipation>3 or more</TestCaseMaximumParticipation>
  <TestCasePreCondition>MIP4.0_Publish_Subscribe_Exchange_Pattern, MIP4SLT1_1130, MIP4SLT1_1131, MIP4SLT1_1154.
Both Consumer and Producer systems conform to MIP4.0 Publish/Subscribe Exchange Pattern Specification.
Both Consumers and Producer are able to process and exchange information represented according to MIP4.0 Information Schemas.Consumers successfully discovered the target Producer. The systems on the Consumer sides have been properly configured and are ready to interact with the Producer system.</TestCasePreCondition>
  <TestCaseInput>N/A.</TestCaseInput>
  <TestCaseConclusion>The test is concluded after the Consumers receive notifications published to the given topic / geographical / source filters, from the Producer.</TestCaseConclusion>
  <TestCaseOutput>N/A.</TestCaseOutput>
  <TestCaseTraceability>REQ_EM_0008, REQ_EM_0010, REQ_SYS_0016, REQ_SYS_0021</TestCaseTraceability>
  <TestCaseStep>
    <TestCaseStepNumber>1</TestCaseStepNumber>
    <TestCaseStepAction>The Consumers (1, 3) subscribe to the Producer (2) in order to advertise their interest in a subset of the data space. </TestCaseStepAction>
    <TestCaseStepResult>The Producer receives  valid requests for resource properties </TestCaseStepResult>
    <TestCaseStepDestination>2</TestCaseStepDestination>
    <TestCaseStepSource>1,3</TestCaseStepSource>
  </TestCaseStep>
  <TestCaseStep>
    <TestCaseStepNumber>2</TestCaseStepNumber>
    <TestCaseStepAction>Producer sends the topics requested to the Consumers. </TestCaseStepAction>
    <TestCaseStepResult>Consumers receive the requested topics. </TestCaseStepResult>
    <TestCaseStepDestination>1,3</TestCaseStepDestination>
    <TestCaseStepSource>2</TestCaseStepSource>
  </TestCaseStep>
  <TestCaseStep>
    <TestCaseStepNumber>3</TestCaseStepNumber>
    <TestCaseStepAction>The Consumers process the list of exposed topics, prepare their filter set, and request their overlapping subscriptions on multiple topics to the Producer.
Notice: the overlap must be two-dimesional:
* Subscriptions from a single Consumer overlap (some data shared by different topics)
* Subscriptions to the same topic from different Consumers </TestCaseStepAction>
    <TestCaseStepResult>Producer receives overlapping subscription requests for multiple topics. </TestCaseStepResult>
    <TestCaseStepDestination>2</TestCaseStepDestination>
    <TestCaseStepSource>1,3</TestCaseStepSource>
  </TestCaseStep>
  <TestCaseStep>
    <TestCaseStepNumber>4</TestCaseStepNumber>
    <TestCaseStepAction>Producer accepts the subscription requests.
Producer checks subscription filters and determines if data match specified filters. If they do, the Producer sends a wsn-b:Notify to the address specified in the wsn-b:ConsumerReference for EACH matching subscription and Consumer.
Notice: Matching data must not be sent more than once to a single Consumer in case of overlapping subscriptions for that consumer. </TestCaseStepAction>
    <TestCaseStepResult>The Producer sends notifications to the Consumers.
The Consumers process the data contained in the messages. </TestCaseStepResult>
    <TestCaseStepDestination>1,3</TestCaseStepDestination>
    <TestCaseStepSource>2</TestCaseStepSource>
  </TestCaseStep>
  <TestCaseStep>
    <TestCaseStepNumber>5</TestCaseStepNumber>
    <TestCaseStepAction>Consumers unsubscribe using wsn-b:Unsubscribe operation with the SubscriptionReference issued from the initial Subscribe responses. </TestCaseStepAction>
    <TestCaseStepResult>Producer destroys the corresponding subscriptions. </TestCaseStepResult>
    <TestCaseStepDestination>2</TestCaseStepDestination>
    <TestCaseStepSource>1,3</TestCaseStepSource>
  </TestCaseStep>
  <TestCaseStep>
    <TestCaseStepNumber>6</TestCaseStepNumber>
    <TestCaseStepAction>Repeat steps 1 to 5 for geographical, source and / or any other kind of subscription filters that should be tested. </TestCaseStepAction>
    <TestCaseStepResult>Corresponding results in 1 to 5 for geographical, source and / or any other kind of subscription filter. </TestCaseStepResult>
    <TestCaseStepDestination />
    <TestCaseStepSource />
  </TestCaseStep>
  <TestCaseEventGeneration>true</TestCaseEventGeneration>
</TestCase>